name: Delete-Old-Workflows

on: 
  repository_dispatch:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up gh CLI
      uses: actions/setup-gh@v2
      with:
        gh-version: 2.2.0

    - name: List recent releases
      run: gh release list --limit 3 --json name

    - name: Delete old releases
      run: |
        releases=$(gh release list --limit 3 --json name | jq -r '.[].name')
        for release in $releases; do
          gh release delete $release
        done
